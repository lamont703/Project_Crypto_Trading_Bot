<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Crypto Trading Bot</title>
    <link rel="stylesheet" href="components.css">
    <style>
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
        }
        
        .settings-section {
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
        }
        
        .section-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
            color: var(--primary-color);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--border-color);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .risk-levels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
        }
        
        .risk-option {
            padding: var(--spacing-lg);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            background-color: var(--bg-primary);
            transition: all var(--transition-fast);
        }
        
        .risk-option:hover {
            border-color: var(--primary-color);
            background-color: var(--bg-secondary);
        }
        
        .risk-option.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
            color: var(--text-inverse);
        }
        
        .risk-option h4 {
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-base);
        }
        
        .risk-option p {
            font-size: var(--font-size-sm);
            opacity: 0.8;
        }
        
        .switch-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color-light);
            border-radius: var(--radius);
            margin-bottom: var(--spacing-sm);
        }
        
        .switch-label {
            font-weight: 600;
            font-size: var(--font-size-base);
        }
        
        .switch-description {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-top: var(--spacing-xs);
        }
        
        .switch-toggle {
            width: 50px;
            height: 25px;
            background-color: var(--gray-300);
            border-radius: 25px;
            position: relative;
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }
        
        .switch-toggle.active {
            background-color: var(--primary-color);
        }
        
        .switch-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background-color: var(--white);
            border-radius: 50%;
            transition: transform var(--transition-fast);
        }
        
        .switch-toggle.active::after {
            transform: translateX(25px);
        }
        
        .api-key-item {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color-light);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .api-key-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }
        
        .api-key-name {
            font-weight: 600;
            font-size: var(--font-size-base);
        }
        
        .api-key-status {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }
        
        .api-key-status.active {
            background-color: var(--success-color);
            color: var(--text-inverse);
        }
        
        .api-key-status.inactive {
            background-color: var(--danger-color);
            color: var(--text-inverse);
        }
        
        .api-key-value {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
            font-family: monospace;
        }
        
        .api-key-actions {
            display: flex;
            gap: var(--spacing-sm);
        }
        
        .api-key-btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all var(--transition-fast);
        }
        
        .api-key-btn:hover {
            background-color: var(--bg-tertiary);
        }
        
        .api-key-btn.edit {
            background-color: var(--primary-color);
            color: var(--text-inverse);
            border-color: var(--primary-color);
        }
        
        .api-key-btn.delete {
            background-color: var(--danger-color);
            color: var(--text-inverse);
            border-color: var(--danger-color);
        }
        
        .add-api-key-btn {
            width: 100%;
            padding: var(--spacing-md);
            background-color: var(--success-color);
            color: var(--text-inverse);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-bottom: var(--spacing-lg);
        }
        
        .add-api-key-btn:hover {
            background-color: var(--success-hover);
        }
        
        .settings-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
        }
        
        .settings-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            min-height: 56px;
        }
        
        .settings-btn.save {
            background-color: var(--primary-color);
            color: var(--text-inverse);
        }
        
        .settings-btn.save:hover {
            background-color: var(--primary-hover);
        }
        
        .settings-btn.reset {
            background-color: var(--secondary-color);
            color: var(--text-inverse);
        }
        
        .settings-btn.reset:hover {
            background-color: var(--gray-600);
        }
        
        .settings-btn.export {
            background-color: var(--info-color);
            color: var(--text-inverse);
        }
        
        .settings-btn.export:hover {
            background-color: var(--info-hover);
        }
        
        .settings-btn.delete {
            background-color: var(--danger-color);
            color: var(--text-inverse);
        }
        
        .settings-btn.delete:hover {
            background-color: var(--danger-hover);
        }
        
        .empty-state {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-muted);
        }
        
        .empty-state-icon {
            font-size: var(--font-size-4xl);
            margin-bottom: var(--spacing-md);
        }
        
        .empty-state-text {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-sm);
        }
        
        .empty-state-subtext {
            font-size: var(--font-size-sm);
        }
        
        @media (min-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .settings-actions {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- App Bar -->
        <div class="app-bar">
            <h1>⚙️ Settings</h1>
        </div>
        
        <!-- Settings Form -->
        <form class="settings-grid" data-form-type="settings" id="settingsForm">
            <!-- Account Settings -->
            <div class="settings-section">
                <h2 class="section-title">Account Settings</h2>
                
                <div class="form-group">
                    <label class="form-label" for="profileName">Profile Name</label>
                    <input type="text" class="form-control" id="profileName" name="profileName" 
                           placeholder="Alex Johnson" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" 
                           placeholder="alex@example.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Risk Profile</label>
                    <div class="risk-levels">
                        <div class="risk-option" data-risk="conservative">
                            <h4>Conservative</h4>
                            <p>Low risk</p>
                        </div>
                        <div class="risk-option selected" data-risk="moderate">
                            <h4>Moderate</h4>
                            <p>Balanced</p>
                        </div>
                        <div class="risk-option" data-risk="aggressive">
                            <h4>Aggressive</h4>
                            <p>High risk</p>
                        </div>
                    </div>
                    <input type="hidden" name="riskProfile" value="moderate" id="riskProfileInput">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="defaultExchange">Default Exchange</label>
                        <select class="form-control" id="defaultExchange" name="defaultExchange">
                            <option value="binance">Binance</option>
                            <option value="coinbase">Coinbase</option>
                            <option value="kraken">Kraken</option>
                            <option value="kucoin">KuCoin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="currency">Currency</label>
                        <select class="form-control" id="currency" name="currency">
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                            <option value="JPY">JPY</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Trading Settings -->
            <div class="settings-section">
                <h2 class="section-title">Trading Settings</h2>
                
                <div class="form-group">
                    <label class="form-label" for="defaultPositionSize">Default Position Size</label>
                    <input type="range" class="form-control" id="defaultPositionSize" name="defaultPositionSize" 
                           min="0.01" max="0.5" step="0.01" value="0.1">
                    <div class="text-center" id="positionSizeValue">10% of portfolio</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="maxPositionSize">Max Position Size</label>
                    <input type="range" class="form-control" id="maxPositionSize" name="maxPositionSize" 
                           min="0.05" max="1.0" step="0.05" value="0.25">
                    <div class="text-center" id="maxPositionSizeValue">25% of portfolio</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="defaultStopLoss">Default Stop Loss</label>
                    <input type="range" class="form-control" id="defaultStopLoss" name="defaultStopLoss" 
                           min="0.01" max="0.2" step="0.01" value="0.05">
                    <div class="text-center" id="stopLossValue">5% stop loss</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="defaultTakeProfit">Default Take Profit</label>
                    <input type="range" class="form-control" id="defaultTakeProfit" name="defaultTakeProfit" 
                           min="0.02" max="0.5" step="0.01" value="0.10">
                    <div class="text-center" id="takeProfitValue">10% take profit</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="defaultTimeInTrade">Default Time in Trade</label>
                    <select class="form-control" id="defaultTimeInTrade" name="defaultTimeInTrade">
                        <option value="1">1 Hour</option>
                        <option value="4">4 Hours</option>
                        <option value="24" selected>24 Hours</option>
                        <option value="168">1 Week</option>
                    </select>
                </div>
            </div>
            
            <!-- Notifications -->
            <div class="settings-section">
                <h2 class="section-title">Notifications</h2>
                
                <div class="switch-group">
                    <div>
                        <div class="switch-label">Price Alerts</div>
                        <div class="switch-description">Get notified when prices hit targets</div>
                    </div>
                    <div class="switch-toggle active" data-notification="priceAlerts"></div>
                </div>
                
                <div class="switch-group">
                    <div>
                        <div class="switch-label">Order Updates</div>
                        <div class="switch-description">Notifications for order status changes</div>
                    </div>
                    <div class="switch-toggle active" data-notification="orderUpdates"></div>
                </div>
                
                <div class="switch-group">
                    <div>
                        <div class="switch-label">News Alerts</div>
                        <div class="switch-description">Important market news and updates</div>
                    </div>
                    <div class="switch-toggle" data-notification="newsAlerts"></div>
                </div>
                
                <div class="switch-group">
                    <div>
                        <div class="switch-label">Strategy Alerts</div>
                        <div class="switch-description">Strategy execution and performance updates</div>
                    </div>
                    <div class="switch-toggle active" data-notification="strategyAlerts"></div>
                </div>
                
                <div class="switch-group">
                    <div>
                        <div class="switch-label">Risk Warnings</div>
                        <div class="switch-description">High risk or unusual market conditions</div>
                    </div>
                    <div class="switch-toggle active" data-notification="riskWarnings"></div>
                </div>
            </div>
            
            <!-- API Keys -->
            <div class="settings-section">
                <h2 class="section-title">Exchange API Keys</h2>
                
                <button type="button" class="add-api-key-btn" onclick="addApiKey()">
                    + Add New API Key
                </button>
                
                <div id="apiKeysList">
                    <!-- API keys will be populated by JavaScript -->
                </div>
            </div>
        </form>
        
        <!-- Settings Actions -->
        <div class="settings-actions">
            <button type="button" class="settings-btn save" onclick="saveSettings()">
                💾 Save Settings
            </button>
            <button type="button" class="settings-btn reset" onclick="resetSettings()">
                🔄 Reset to Defaults
            </button>
            <button type="button" class="settings-btn export" onclick="exportData()">
                📤 Export Data
            </button>
            <button type="button" class="settings-btn delete" onclick="deleteAccount()">
                🗑️ Delete Account
            </button>
        </div>
    </div>
    
    <!-- Bottom Tab Bar (Mobile) -->
    <div class="tab-bar">
        <div class="tab-item" data-screen="dashboard">
            <div class="tab-icon">📊</div>
            <div class="tab-label">Dashboard</div>
        </div>
        <div class="tab-item" data-screen="market">
            <div class="tab-icon">📈</div>
            <div class="tab-label">Market</div>
        </div>
        <div class="tab-item" data-screen="strategy">
            <div class="tab-icon">⚙️</div>
            <div class="tab-label">Strategy</div>
        </div>
        <div class="tab-item" data-screen="trade">
            <div class="tab-icon">��</div>
            <div class="tab-label">Trade</div>
        </div>
        <div class="tab-item active" data-screen="settings">
            <div class="tab-icon">⚙️</div>
            <div class="tab-label">Settings</div>
        </div>
    </div>
    
    <script src="app.js"></script>
    <script>
        // Settings specific functionality
        document.addEventListener('DOMContentLoaded', async function() {
            // Wait for app to initialize
            await new Promise(resolve => {
                const checkApp = () => {
                    if (window.cryptoBotApp) {
                        resolve();
                    } else {
                        setTimeout(checkApp, 100);
                    }
                };
                checkApp();
            });
            
            const app = window.cryptoBotApp;
            
            // Load settings
            loadSettings(app);
            
            // Set up event listeners
            setupEventListeners();
        });
        
        function loadSettings(app) {
            const settings = app.getSettings();
            const user = app.sampleData?.user;
            
            // Load user data
            if (user) {
                document.getElementById('profileName').value = user.name || '';
                document.getElementById('email').value = user.email || '';
            }
            
            // Load risk profile
            const riskProfile = user?.riskProfile || settings.trading?.riskProfile || 'moderate';
            document.querySelectorAll('.risk-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.risk === riskProfile) {
                    option.classList.add('selected');
                    document.getElementById('riskProfileInput').value = riskProfile;
                }
            });
            
            // Load trading settings
            if (settings.trading) {
                document.getElementById('defaultPositionSize').value = settings.trading.defaultPositionSize || 0.1;
                document.getElementById('maxPositionSize').value = settings.trading.maxPositionSize || 0.25;
                document.getElementById('defaultStopLoss').value = settings.trading.defaultStopLoss || 0.05;
                document.getElementById('defaultTakeProfit').value = settings.trading.defaultTakeProfit || 0.10;
                document.getElementById('defaultTimeInTrade').value = settings.trading.defaultTimeInTrade || 24;
                
                updateSliderValues();
            }
            
            // Load notification settings
            if (settings.notifications) {
                Object.keys(settings.notifications).forEach(key => {
                    const toggle = document.querySelector(`[data-notification="${key}"]`);
                    if (toggle) {
                        if (settings.notifications[key]) {
                            toggle.classList.add('active');
                        } else {
                            toggle.classList.remove('active');
                        }
                    }
                });
            }
            
            // Load API keys
            loadApiKeys();
        }
        
        function setupEventListeners() {
            // Risk profile selection
            document.querySelectorAll('.risk-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.risk-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('riskProfileInput').value = this.dataset.risk;
                });
            });
            
            // Slider updates
            document.getElementById('defaultPositionSize').addEventListener('input', updateSliderValues);
            document.getElementById('maxPositionSize').addEventListener('input', updateSliderValues);
            document.getElementById('defaultStopLoss').addEventListener('input', updateSliderValues);
            document.getElementById('defaultTakeProfit').addEventListener('input', updateSliderValues);
            
            // Notification toggles
            document.querySelectorAll('.switch-toggle').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            });
        }
        
        function updateSliderValues() {
            const positionSize = (document.getElementById('defaultPositionSize').value * 100).toFixed(0);
            const maxPositionSize = (document.getElementById('maxPositionSize').value * 100).toFixed(0);
            const stopLoss = (document.getElementById('defaultStopLoss').value * 100).toFixed(0);
            const takeProfit = (document.getElementById('defaultTakeProfit').value * 100).toFixed(0);
            
            document.getElementById('positionSizeValue').textContent = `${positionSize}% of portfolio`;
            document.getElementById('maxPositionSizeValue').textContent = `${maxPositionSize}% of portfolio`;
            document.getElementById('stopLossValue').textContent = `${stopLoss}% stop loss`;
            document.getElementById('takeProfitValue').textContent = `${takeProfit}% take profit`;
        }
        
        function loadApiKeys() {
            const container = document.getElementById('apiKeysList');
            
            // Mock API keys data
            const apiKeys = [
                {
                    id: 'key_001',
                    name: 'Binance Main Account',
                    exchange: 'binance',
                    status: 'active',
                    key: '********************1234'
                },
                {
                    id: 'key_002',
                    name: 'Coinbase Pro',
                    exchange: 'coinbase',
                    status: 'inactive',
                    key: '********************5678'
                }
            ];
            
            if (apiKeys.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🔑</div>
                        <div class="empty-state-text">No API keys configured</div>
                        <div class="empty-state-subtext">Add exchange API keys to enable trading</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = apiKeys.map(key => `
                <div class="api-key-item">
                    <div class="api-key-header">
                        <div class="api-key-name">${key.name}</div>
                        <div class="api-key-status ${key.status}">${key.status}</div>
                    </div>
                    <div class="api-key-value">API Key: ${key.key}</div>
                    <div class="api-key-actions">
                        <button type="button" class="api-key-btn edit" onclick="editApiKey('${key.id}')">
                            Edit
                        </button>
                        <button type="button" class="api-key-btn" onclick="testApiKey('${key.id}')">
                            Test
                        </button>
                        <button type="button" class="api-key-btn delete" onclick="deleteApiKey('${key.id}')">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function saveSettings() {
            const form = document.getElementById('settingsForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // Collect notification settings
            const notifications = {};
            document.querySelectorAll('.switch-toggle').forEach(toggle => {
                const key = toggle.dataset.notification;
                notifications[key] = toggle.classList.contains('active');
            });
            
            // Create settings object
            const settings = {
                profileName: data.profileName,
                email: data.email,
                riskProfile: data.riskProfile,
                defaultExchange: data.defaultExchange,
                currency: data.currency,
                trading: {
                    defaultPositionSize: parseFloat(data.defaultPositionSize),
                    maxPositionSize: parseFloat(data.maxPositionSize),
                    defaultStopLoss: parseFloat(data.defaultStopLoss),
                    defaultTakeProfit: parseFloat(data.defaultTakeProfit),
                    defaultTimeInTrade: parseInt(data.defaultTimeInTrade)
                },
                notifications: notifications
            };
            
            // Save to localStorage
            localStorage.setItem('settings', JSON.stringify(settings));
            
            window.cryptoBotApp.showToast('Settings saved successfully', 'success');
            window.cryptoBotApp.announce('Settings saved successfully');
        }
        
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to defaults?')) {
                localStorage.removeItem('settings');
                location.reload();
            }
        }
        
        function exportData() {
            const settings = window.cryptoBotApp.getSettings();
            const strategies = window.cryptoBotApp.getStrategies();
            
            const exportData = {
                settings: settings,
                strategies: strategies,
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `crypto_bot_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            window.cryptoBotApp.showToast('Data exported successfully', 'success');
        }
        
        function deleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
                    localStorage.clear();
                    window.cryptoBotApp.showToast('Account deleted', 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
            }
        }
        
        function addApiKey() {
            window.cryptoBotApp.showToast('Add API key form would open', 'info');
        }
        
        function editApiKey(keyId) {
            window.cryptoBotApp.showToast('Edit API key form would open', 'info');
        }
        
        function testApiKey(keyId) {
            window.cryptoBotApp.showToast('API key test successful', 'success');
        }
        
        function deleteApiKey(keyId) {
            if (confirm('Are you sure you want to delete this API key?')) {
                window.cryptoBotApp.showToast('API key deleted', 'success');
                loadApiKeys(); // Reload the list
            }
        }
    </script>
</body>
</html>
